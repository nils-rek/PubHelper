}
meanpooled(n1 = 30, n2 = 20, mean1 = 15, mean2 = 20)
devtools::document()
library("devtools")
.libPaths("C:/Users/nkapp/R")
library("devtools")
document()
data(airquality)
head(airquality)
airquality[1,] = NULL
airquality[-1,] = NULL
data = airquality
head(airquality)
summary(airquality)
vars = c("Ozone", "Solar.R", "Wind", "Temp")
labels = NULL
grouping.var = NULL
round_dec = 2
placeholder = "   "
welch.test = FALSE;
na.statistics = "all";
print.vars = FALSE
airquality$Period = ifelse(airquality$Month %in% 5:7, "Early Summer", "Late Summer")
addGroupInfoToTable <- function(
data,
output,
vars,
placeholder,
round_dec,
grouping.var,
welch.test
)   {
## Get levels of new variable
group.levels = unique(data[, grouping.var])
group.levels = group.levels[!is.na(group.levels)]
## Create additional columns
output[, c(group.levels, "test")] = NA
## Fill new columns in loop
for(i in vars) {
# Save output.type
output.type = output[output$vars == i, "output.type"][1]
## Run tests and fill test column depending on output.type
if(output.type == "cont")   {
# T-test if 2 levels and ANOVA if more levels
if(length(group.levels) == 2) {
# Run t-test
t.test_results = t.test(data[, i] ~ data[, grouping.var], var.equal = !welch.test)
t.test_p = ifelse(t.test_results$p.value < 0.001, "<0.001",
as.character(round(t.test_results$p.value, 3)))
# Save
output[max(which(output$vars == i)), "test"] = t.test_p
} else   {
# Run ANOVA
anova_results = summary(aov(data[, i] ~ data[, grouping.var]))
anova_p = ifelse(anova_results[[1]][["Pr(>F)"]] < 0.001, "<0.001",
as.character(round(anova_results[[1]][["Pr(>F)"]], 3)))
# Save
output[max(which(output$vars == i)), "test"] = anova_p
}
} else   {
## Run chi.square test
chisq_results = chisq.test(data[, i], data[, grouping.var], correct = TRUE)
chisq_p = ifelse(chisq_results$p.value < 0.001, "<0.001",
as.character(round(chisq_results$p.value, 3)))
# Save
output[max(which(output$vars == i)), "test"] = chisq_p
}
## Fill group column
for(g in group.levels)  {
nrow_group = nrow(data[data[, grouping.var] == g,])
if(output.type == "cat")   {
# Add proportion
for(j in 2:(length(which(output$vars == i))- 1)) {
temp_rows = which(output$vars == i)
temp_cell_no = nrow(data[data[, grouping.var] == g &
data[,i] == output[temp_rows[j], "levels"],])
output[temp_rows[j], g] =
paste0(temp_cell_no, " (",
round(temp_cell_no / nrow_group * 100, round_dec), "%)")
}
} else   {
# Mean (SD)
output[output$vars == i & output$description == paste0(placeholder, "Mean (SD)"), g] =
paste0(round(mean(data[data[,grouping.var] == g, i], na.rm = TRUE), round_dec), " (",
round(sd(data[data[,grouping.var] == g, i], na.rm = TRUE), round_dec), ")")
# Median (IQR)
output[output$vars == i & output$description == paste0(placeholder, "Median (IQR)"), g] =
paste0(round(median(data[data[,grouping.var] == g, i], na.rm = TRUE), round_dec),
" (", round(summary(data[data[,grouping.var] == g, i])[2], round_dec), "-",
round(summary(data[data[,grouping.var] == g, i])[5], round_dec), ")")
}
# Add missing
output[output$vars == i & output$description == paste0(placeholder, "Missing (%)"), g] =
paste0(sum(is.na(data[data[,grouping.var] == g, i])), " (",
round(sum(is.na(data[data[,grouping.var] == g, i])) / nrow_group * 100,
round_dec), "%)")
}
}
return(output)
}
createOutputTable <- function(
data,
vars,
labels,
round_dec,
placeholder,
var.details
)   {
## Create empty table
output = data.frame(vars = character(),
levels = character(),
output.type = character(),
description = character(),
statistic = character())
## Get nrow
nrow_data = nrow(data)
for(i in 1:length(vars))    {
## Get new row numbers
output.type = var.details[i, "output"]
newrows_start = nrow(output) + 1
newrows_end = newrows_start + ifelse(output.type == "cont", 3,
var.details[i, "levels"] + 1)
newrows = newrows_start:newrows_end
## Get unique values if categorical output.type
if(output.type == "cat")      {
output.values = unique(data[, vars[i]])
output.values = sort(output.values[!is.na(output.values)])
}
## Create new empty rows
output[newrows,] = NA
## Set vars, levels, output.type & labels
output[newrows, "vars"] = vars[i]
output[newrows, "output.type"] = output.type
output[newrows_start, "description"] = labels[i]
output[newrows_end, "description"] = paste0(placeholder, "Missing (%)")
## Write differently for continuous and categorical variables
if(output.type == "cont")     {
# Set descriptions
output[newrows[2:3], "description"] = paste0(placeholder, c("Mean (SD)",
"Median (IQR)"))
# Fill Mean (SD)
output[newrows[2], "statistic"] =
paste0(round(mean(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(sd(data[, vars[i]], na.rm = TRUE), round_dec), ")")
# Fill Median (IQR)
output[newrows[3], "statistic"] =
paste0(round(median(data[,vars[i]], na.rm = TRUE), round_dec), " (",
round(summary(data[, vars[i]])[2], round_dec), "-",
round(summary(data[, vars[i]])[5], round_dec), ")")
} else      {
# Set descriptions
output[newrows[2:(length(newrows) - 1)], "description"] =
as.character(output.values)
# Fill N (%)
for(j in output.values) {
output[output$description == j, "statistic"] =
paste0(sum(data[!is.na(data[, vars[i]]), vars[i]] == j), " (",
round(sum(data[!is.na(data[, vars[i]]), vars[i]] == j) /
nrow_data * 100, round_dec),
"%)")
}
# Save output.value as levels and add zeroes to output.value descriptions
output[newrows[2:(length(newrows) - 1)], "levels"] =
output[newrows[2:(length(newrows) - 1)], "description"]
output[newrows[2:(length(newrows) - 1)], "description"] =
paste0(placeholder, output.values)
}
## Set missing N (%)
output[newrows_end, "statistic"] =
paste0(sum(is.na(data[, vars[i]])), " (",
round(sum(is.na(data[, vars[i]])) / nrow_data * 100, round_dec), "%)")
}
## Return output
return(output)
}
# Infer classes and levels of variables
var.details = data.frame(var = vars,
class = NA,
levels = NA)
# Set labels
if(is.null(labels)){labels = vars}
for(i in vars) {
var.details[var.details$var == i, "class"] = class(data[, i])
var.details[var.details$var == i, "levels"] = length(unique(data[!is.na(data[, i]), i]))
}
# Define table class
var.details$output = ifelse(var.details$class %in% c("numeric", "integer") &
var.details$levels > 2, "cont", "cat")
## Create output table
output = createOutputTable(data = data, vars = vars, labels = labels,
var.details = var.details, round_dec = round_dec,
placeholder = placeholder)
output
output$description == paste0(placeholder, "Missing (%)") &
output$statistic == "0 (0%)"
output$description == paste0(placeholder, "Missing (%)")
# Delete missing value rows
row_to_delete = output$description == paste0(placeholder, "Missing (%)")
output[!row_to_delete,]
grouping.var = "Period"
## Extend table with grouping variables
if(!is.null(grouping.var)) {
output = addGroupInfoToTable(data = data, output = output,
vars = vars, grouping.var = grouping.var,
placeholder = placeholder,  welch.test = welch.test)
}
output
welch.test
# Set labels
if(is.null(labels)){labels = vars}
# Give error if labels have different length
if(length(labels) != length(vars))  {
stop("labels needs to be the same length as vars.")
}
# Infer classes and levels of variables
var.details = data.frame(var = vars,
class = NA,
levels = NA)
for(i in vars) {
var.details[var.details$var == i, "class"] = class(data[, i])
var.details[var.details$var == i, "levels"] = length(unique(data[!is.na(data[, i]), i]))
}
# Define table class
var.details$output = ifelse(var.details$class %in% c("numeric", "integer") &
var.details$levels > 2, "cont", "cat")
## Create output table
output = createOutputTable(data = data, vars = vars, labels = labels,
var.details = var.details, round_dec = round_dec,
placeholder = placeholder)
## Extend table with grouping variables
if(!is.null(grouping.var)) {
output = addGroupInfoToTable(data = data, output = output,
vars = vars, grouping.var = grouping.var,
placeholder = placeholder,  welch.test = welch.test)
}
head(airquality)
data = airquality
## Extend table with grouping variables
if(!is.null(grouping.var)) {
output = addGroupInfoToTable(data = data, output = output,
vars = vars, grouping.var = grouping.var,
placeholder = placeholder,  welch.test = welch.test)
}
output
output$test
c(output$test[2:length(output$test)], NA)
output$test = c(output$test[2:length(output$test)], NA)
output
# Delete missing value rows
row_to_delete = output$description == paste0(placeholder, "Missing (%)")
output = output[!row_to_delete,]
output
.libPaths("C:/Users/nkapp/R")
library("devtools")
document()
.libPaths("C:/Users/nkapp/R")
library("devtools")
document()
document()
data(airquality)
head(airquality)
model = lm(Temp ~ Wind, data = airquality)
summary(model)
?stopifnot
stopifnot(is.null(model), "A model object must be specified.")
stopifnot(1 == 1, all.equal(pi, 3.14159265), 1 < 2)
stopifnot(1 == 2, all.equal(pi, 3.14159265), 1 < 2)
class(model)
# Get GLM class
glm_class = class(model)
summary(model)
coef(model)
names(coef(model))
coef(model)
sqrt(diag(vcov(model)))
summary(model)
summary(model)[["coefficients"]][, "t value"]
summary(model)[["coefficients"]][, "Pr(>|t|)"]
summary(model)$r.squared
rep(NA, length(coef(model)) - 1)
summary(model)$r.squared)
summary(model)$r.squared
c(rep(NA, length(coef(model)) - 1), summary(model)$r.squared)
str(summary(model))
output = data.frame(
Predictor = names(coef(model)),
Estimate = coef(model),
SE = sqrt(diag(vcov(model))),
tval = summary(model)[["coefficients"]][, "t value"],
pval = summary(model)[["coefficients"]][, "Pr(>|t|)"],
r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$r.squared),
adj.r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$adj.r.squared),
)
output = data.frame(
Predictor = names(coef(model)),
Estimate = coef(model),
SE = sqrt(diag(vcov(model))),
tval = summary(model)[["coefficients"]][, "t value"],
pval = summary(model)[["coefficients"]][, "Pr(>|t|)"],
r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$r.squared),
adj.r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$adj.r.squared)
)
output
with(output, Estimate - 1.96* SE)
format_lm = function(
model = model
) {
## Create data.frame with model output
output = data.frame(
Predictor = names(coef(model)),
Estimate = coef(model),
SE = sqrt(diag(vcov(model))),
tval = summary(model)[["coefficients"]][, "t value"],
pval = summary(model)[["coefficients"]][, "Pr(>|t|)"],
r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$r.squared),
adj.r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$adj.r.squared)
)
## Calculate 95% CI
output$ci.lb = with(output, Estimate - 1.96* SE)
output$ci.ub = with(output, Estimate - 1.96* SE)
## Return output
return(output)
}
output = data.frame(
Predictor = names(coef(model)),
Estimate = coef(model),
SE = sqrt(diag(vcov(model))),
tval = summary(model)[["coefficients"]][, "t value"],
pval = summary(model)[["coefficients"]][, "Pr(>|t|)"],
r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$r.squared),
adj.r.squared = c(rep(NA, length(coef(model)) - 1), summary(model)$adj.r.squared)
)
## Calculate 95% CI
output$ci.lb = with(output, Estimate - 1.96* SE)
output$ci.ub = with(output, Estimate - 1.96* SE)
output
output$ci.ub = with(output, Estimate + 1.96* SE)
output
round_dec = 2
round(output[, c("Estimate", "SE", "pval")], round_dec)
output$pval = ifelse(output$pval < 0.001, "<0.001",
as.character(round(output$pval, 3)))
head(output)
output[output$Predictor != "(Intercept)",]
exclude.covariates = "Wind"
output[output$Predictor %in% exclude.covariates,]
head(airquality)
model = lm(Temp ~ Wind + Ozone, data = airquality)
summary(model)
output = format_lm(model = model)
output
exclude.covariates = "Ozone"
sum(!is.na(output[output$Predictor %in% exclude.covariates, "r.squared"]))
sum(!is.na(output[output$Predictor %in% exclude.covariates, "r.squared"])) == 1
output[nrow(output), c("r.squared", "adj.r.squared")]
lm_model.fit = output[nrow(output), c("r.squared", "adj.r.squared")]
is.null(xy)
exists(lm_model.fit2)
exists("lm_model.fit")
exists("lm_model.fit2")
output
## Exclude covariate rows
output = output[output$Predictor %in% exclude.covariates == FALSE,]
output
## Include fit statistics again if necessary
if(exists("lm_model.fit"))  {output[nrow(output), c("r.squared", "adj.r.squared")] = lm_model.fit}
output
with(output, data.frame(
Predictor = Predictor,
'Estimate (SE)' = paste0(round(Estimate, round_dec), " (",
round(SE, round_dec), ")"),
'T-Value' = tval
))
## Format P-value
output$pval = ifelse(output$pval < 0.001, "<0.001",
as.character(round(output$pval, 3)))
with(output, data.frame(
Predictor = Predictor,
Estimate.SE = paste0(round(Estimate, round_dec), " (",
round(SE, round_dec), ")"),
CI = paste0(round(ci.lb, round_dec), "-", round(ci.ub, round_dec)),
T.Value = round(tval, round_dec),
P = pval,
R2 = round(r.squared, round_dec),
R2.adj = round(adj.r.squared, round_dec)
))
lm.ci = FALSE
output = with(output, data.frame(
Predictor = Predictor,
Estimate.SE = paste0(round(Estimate, round_dec), " (",
round(SE, round_dec), ")"),
CI = paste0(round(ci.lb, round_dec), "-", round(ci.ub, round_dec)),
T.Value = round(tval, round_dec),
P = pval,
R2 = round(r.squared, round_dec),
R2.adj = round(adj.r.squared, round_dec)
))
output
## Delete CI if indicated
if(lm.ci == FALSE)  {output$CI = NULL}
output
head(airquality)
?baselineTable
library("PubHelper")
.libPaths()
.libPaths("C:/Users/nkapp/R")
library("PubHelper")
?baselineTable
airquality$Period = ifelse(airquality$Month %in% 5:7, "Early Summer", "Late Summer")
model = glm(Period ~ Wind + Temp, data = airquality, family = "binomial")
airquality$earlySummer = ifelse(airquality$Month %in% 5:7, 1, 0)
model = glm(earlySummer ~ Wind + Temp, data = airquality, family = "binomial")
summary(model)
class(model)
class(model) == "lm"
identical(glm_class, "lm")
identical(class(model), c("glm", "lm"))
summary(model)
names(coef(model))
coef(model)
sqrt(diag(vcov(model)))
summary(model)
summary(model)[["coefficients"]][, "z value"]
summary(model)[["coefficients"]][, "Pr(>|t|)"]
summary(model)[["coefficients"]][, "Pr(>|z|)"]
exp(coef(model))
output = data.frame(
Predictor = names(coef(model)),
OR = exp(coef(model)),
Estimate = coef(model),
SE = sqrt(diag(vcov(model))),
zval = summary(model)[["coefficients"]][, "z value"],
pval = summary(model)[["coefficients"]][, "Pr(>|z|)"]
)
## Calculate 95% CI
output$ci.lb = exp(with(output, Estimate - 1.96* SE))
output$ci.ub = exp(with(output, Estimate + 1.96* SE))
output
## Format P-value
output$pval = ifelse(output$pval < 0.001, "<0.001",
as.character(round(output$pval, 3)))
with(output, data.frame(
Predictor = Predictor,
Estimate.SE = paste0(round(Estimate, round_dec), " (",
round(SE, round_dec), ")"),
OR.CI = paste0(round(OR, round_dec), " (",
round(ci.lb, round_dec), "-",
round(ci.lb, round_dec), ")"),
Z.Value = round(zval, round_dec),
P = pval
))
output[output$Predictor == "(Intercept)", "OR.CI"]
output = with(output, data.frame(
Predictor = Predictor,
Estimate.SE = paste0(round(Estimate, round_dec), " (",
round(SE, round_dec), ")"),
OR.CI = paste0(round(OR, round_dec), " (",
round(ci.lb, round_dec), "-",
round(ci.lb, round_dec), ")"),
Z.Value = round(zval, round_dec),
P = pval
))
output[output$Predictor == "(Intercept)", "OR.CI"]
## Set Intercept OR to "-"
output[output$Predictor == "(Intercept)", "OR.CI"] = "-"
output
output = output[output$Predictor != "(Intercept)", ]
output[output$Predictor == "(Intercept)", "OR.CI"] = "-"
output
library("devtools")
document()
.libPaths("C:/Users/nkapp/R")
.libPaths()
?write.table
library("devtools")
document()
.libPaths("C:/Users/nkapp/R")
library("devtools")
document()
.libPaths("C:/Users/nkapp/R")
library("devtools")
document()
.libPaths("C:/Users/nkapp/R")
library("devtools")
document()
data("bfi")
library("devtools")
.libPaths("C:/Users/nkapp/R")
data("bfi")
library("devtools")
data("airquality")
head(airquality)
?polr
??olr
??polr
library("MASS")
.W <- Womenlf
.W$partic <- factor(.W$partic, levels=c("not.work", "parttime", "fulltime"))
poTest(polr(partic ~ hincome + children + region, data=.W))
?poTest
?poTest()
library("devtools")
install_githubt("nkappelmann/PubHelper")
install_github("nkappelmann/PubHelper")
library("PubHelper")
head(airquality)
airquality$earlysummer = ifelse(airquality$Motn)
airquality$earlysummer = ifelse(airquality$Month %in% 4:8, 1, 0)
model = glm(earlysummer ~ Temp + Wind, data = airquality)
model = glm(earlysummer ~ Temp + Wind, data = airquality, family = "binomial")
summary(model)
formatGLMTable(model)
